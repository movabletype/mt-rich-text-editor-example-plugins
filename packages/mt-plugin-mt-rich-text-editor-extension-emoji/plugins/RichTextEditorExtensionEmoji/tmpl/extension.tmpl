<mt:setvarblock name="js_include" append="1">
  <script type="module">
    const emjiMap = {
      bow: "ðŸ™‡",
      smile: "ðŸ˜Š",
      heart: "â¤ï¸",
      laugh: "ðŸ˜‚",
      angry: "ðŸ˜ ",
      sad: "ðŸ˜¢",
      cry: "ðŸ˜­",
      sleepy: "ðŸ˜ª",
      hug: "ðŸ¤—",
      clap: "ðŸ‘",
      hand: "ðŸ‘‹",
      ok: "ðŸ‘Œ",
      "+1": "ðŸ‘",
      "-1": "ðŸ‘Ž",
    };

    MTRichTextEditor.import("@tiptap/core").then(({ Extension, InputRule }) => {
      const RichTextEditorExtensionEmoji = Extension.create({
        name: "richTextEditorExtensionEmoji",
        addInputRules() {
          return [
            new InputRule({
              find: new RegExp(
                `:(${Object.keys(emjiMap)
                  .map((key) => key.replace(/\+/g, "\\+"))
                  .join("|")}):$`,
                "i"
              ),
              handler: ({ state, range, match }) => {
                state.tr.insertText(emjiMap[match[1]], range.from, range.to);
              },
            }),
          ];
        },
      });

      MTRichTextEditor.on("create", (options) => {
        options.extensions.push(RichTextEditorExtensionEmoji);
      });
    });
  </script>
</mt:setvarblock>

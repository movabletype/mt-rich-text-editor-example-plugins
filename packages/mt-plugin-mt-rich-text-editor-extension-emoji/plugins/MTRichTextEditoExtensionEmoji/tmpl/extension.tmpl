<mt:setvarblock name="js_include" append="1">
  <script type="module">
    const emojiMap = {
      bow: "🙇",
      smile: "😊",
      heart: "❤️",
      laugh: "😂",
      angry: "😠",
      sad: "😢",
      cry: "😭",
      sleepy: "😪",
      hug: "🤗",
      clap: "👏",
      hand: "👋",
      ok: "👌",
      "+1": "👍",
      "-1": "👎",
    };

    // dynamically import "@tiptap/core" via MTRichTextEditor.import API,
    MTRichTextEditor.import("@tiptap/core").then(({ Extension, InputRule }) => {
      // create an Tiptap extension to add an input rule for emoji.
      const RichTextEditorExtensionEmoji = Extension.create({
        name: "richTextEditorExtensionEmoji",
        addInputRules() {
          return [
            new InputRule({
              find: new RegExp(
                `:(${Object.keys(emojiMap)
                  .map((key) => key.replace(/\+/g, "\\+"))
                  .join("|")}):$`,
                "i"
              ),
              handler: ({ state, range, match }) => {
                state.tr.insertText(emojiMap[match[1]], range.from, range.to);
              },
            }),
          ];
        },
      });

      // install the extension
      MTRichTextEditor.on("create", (options) => {
        options.extensions.push(RichTextEditorExtensionEmoji);
      });
    });
  </script>
</mt:setvarblock>
